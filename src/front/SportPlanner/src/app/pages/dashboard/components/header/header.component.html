<!-- Dashboard Header Component -->
<header [class]="getHeaderClasses()" role="banner">
  <!-- Left Section: User Info + Sidebar Toggle -->
  <div class="flex items-center space-x-4">
    
    <!-- Sidebar Toggle Button -->
    <button
      type="button"
      [class]="getToggleButtonClasses()"
      (click)="onToggleSidebar()"
      [attr.aria-label]="isSidebarExpanded() ? 'Ocultar menú lateral' : 'Mostrar menú lateral'"
      [attr.aria-expanded]="isSidebarExpanded()"
      data-testid="sidebar-toggle"
    >
      <!-- Hamburger/Menu Icon for Mobile or Collapse Icon for Desktop -->
      @if (isSidebarExpanded()) {
        <!-- Collapse Icon (when expanded) -->
        <svg 
          class="h-5 w-5" 
          fill="none" 
          stroke="currentColor" 
          viewBox="0 0 24 24"
          data-testid="sidebar-collapse-icon"
          aria-hidden="true"
        >
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 19l-7-7 7-7m8 14l-7-7 7-7" />
        </svg>
      } @else {
        <!-- Expand/Hamburger Icon (when collapsed) -->
        <svg 
          class="h-5 w-5" 
          fill="none" 
          stroke="currentColor" 
          viewBox="0 0 24 24"
          data-testid="sidebar-expand-icon"
          aria-hidden="true"
        >
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
        </svg>
      }
    </button>

    <!-- User Information -->
    <div [class]="getUserInfoClasses()" data-testid="user-info">
      <button
        #userButtonRef
        type="button"
        [class]="getUserButtonClasses()"
        (click)="onUserMenuClick()"
        [attr.aria-label]="'Abrir menú de ' + userName()"
        aria-haspopup="true"
        [attr.aria-expanded]="isDropdownOpen()"
        data-testid="user-button"
      >
        <!-- User Avatar -->
        <div [class]="getAvatarClasses()">
          <span 
            class="text-primary-foreground text-sm font-medium select-none"
            data-testid="user-initials"
          >
            {{ userInitials() }}
          </span>
        </div>

        <!-- User Details (Hidden on mobile) -->
        <div [class]="getUserDetailsClasses()" data-testid="user-details">
          <p 
            class="text-sm font-medium text-foreground truncate"
            data-testid="user-name"
          >
            {{ userName() }}
          </p>
          @if (userEmail()) {
            <p 
              class="text-xs text-muted-foreground truncate"
              data-testid="user-email"
            >
              {{ userEmail() }}
            </p>
          }
        </div>

        <!-- Dropdown Arrow (only on desktop) -->
        <svg 
          class="hidden md:block h-4 w-4 text-muted-foreground group-hover:text-foreground transition-colors duration-200" 
          fill="none" 
          stroke="currentColor" 
          viewBox="0 0 24 24"
          aria-hidden="true"
        >
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
        </svg>
      </button>
    </div>
  </div>

  <!-- Center Section: Page Title -->
  <div class="flex-1 flex justify-center min-w-0">
    <h1 [class]="getTitleClasses()" data-testid="page-title">
      {{ title() }}
    </h1>
  </div>

  <!-- Right Section: Additional Controls (placeholder for future features) -->
  <div class="flex items-center space-x-2">
    <!-- Notifications, Search, etc. can be added here in the future -->
    <div class="w-8"></div> <!-- Spacer to balance the layout -->
  </div>
</header>

<!-- User Profile Dropdown -->
<app-user-profile-dropdown
  [isOpen]="isDropdownOpen()"
  [triggerElement]="userButtonRef"
  [userName]="userName()"
  [userEmail]="userEmail()"
  (closed)="onDropdownClosed()"
  (portalClicked)="onPortalClick()"
  (logoutClicked)="onLogoutClick()">
</app-user-profile-dropdown>
