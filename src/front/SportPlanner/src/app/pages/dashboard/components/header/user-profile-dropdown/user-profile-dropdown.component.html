<!-- User Profile Dropdown Template -->
<ng-template #dropdownTemplate>
  <div 
    [class]="getDropdownClasses()"
    role="menu"
    aria-live="polite"
    aria-label="Menú de usuario"
    data-testid="dropdown-content"
    (keydown.escape)="onEscapeKey()"
  >
    
    <!-- User Information Header -->
    <div [class]="getUserInfoClasses()">
      <!-- User Avatar -->
      <div [class]="getAvatarClasses()">
        <span 
          class="text-primary-foreground text-sm font-medium select-none"
          data-testid="dropdown-user-initials"
        >
          {{ userInitials() }}
        </span>
      </div>

      <!-- User Details -->
      <div [class]="getUserDetailsClasses()">
        <p 
          class="text-sm font-semibold text-popover-foreground truncate"
          data-testid="dropdown-user-name"
        >
          {{ userName() }}
        </p>
        @if (userEmail()) {
          <p 
            class="text-xs text-muted-foreground truncate"
            data-testid="dropdown-user-email"
          >
            {{ userEmail() }}
          </p>
        }
      </div>
    </div>

    <!-- Menu Options -->
    <div role="none">
      
      <!-- Portal de Usuario Option -->
      <div
        [class]="getMenuItemClasses()"
        role="menuitem"
        tabindex="0"
        (click)="onPortalClick()"
        (keydown)="onKeyDown($event, 'portal')"
        aria-label="Acceder al portal de usuario"
        data-testid="portal-option"
      >
        <!-- User Portal Icon -->
        <svg 
          [class]="getIconClasses()" 
          fill="none" 
          stroke="currentColor" 
          viewBox="0 0 24 24"
          aria-hidden="true"
        >
          <path 
            stroke-linecap="round" 
            stroke-linejoin="round" 
            stroke-width="2" 
            d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"
          />
        </svg>
        
        <span class="font-medium">Portal de Usuario</span>
      </div>

      <!-- Separator -->
      <div class="border-t border-border my-1" aria-hidden="true"></div>

      <!-- Logout Option -->
      <div
        [class]="getMenuItemClasses()"
        role="menuitem"
        tabindex="0"
        (click)="onLogoutClick()"
        (keydown)="onKeyDown($event, 'logout')"
        aria-label="Cerrar sesión"
        data-testid="logout-option"
      >
        <!-- Logout Icon -->
        <svg 
          [class]="getIconClasses()" 
          fill="none" 
          stroke="currentColor" 
          viewBox="0 0 24 24"
          aria-hidden="true"
        >
          <path 
            stroke-linecap="round" 
            stroke-linejoin="round" 
            stroke-width="2" 
            d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"
          />
        </svg>
        
        <span class="font-medium">Logout</span>
      </div>
    </div>
  </div>
</ng-template>
